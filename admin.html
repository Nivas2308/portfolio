<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Portfolio Analytics Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        background: #ffffff;
        color: #1f2937;
        line-height: 1.6;
      }

      .dashboard-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 2rem;
      }

      .dashboard-header {
        text-align: center;
        margin-bottom: 3rem;
        padding: 2rem 0;
        background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
        color: white;
        border-radius: 16px;
        box-shadow: 0 10px 30px rgba(59, 130, 246, 0.3);
      }

      .dashboard-header h1 {
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
      }

      .dashboard-header p {
        font-size: 1.1rem;
        opacity: 0.9;
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 2rem;
        margin-bottom: 3rem;
      }

      .stat-card {
        background: white;
        border-radius: 16px;
        padding: 2rem;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        border: 1px solid #e5e7eb;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .stat-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, #3b82f6, #1e40af);
      }

      .stat-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 30px rgba(59, 130, 246, 0.15);
      }

      .stat-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
      }

      .stat-icon {
        width: 48px;
        height: 48px;
        background: linear-gradient(135deg, #3b82f6, #1e40af);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.2rem;
      }

      .stat-value {
        font-size: 2.5rem;
        font-weight: 700;
        color: #1f2937;
        margin-bottom: 0.5rem;
      }

      .stat-label {
        color: #6b7280;
        font-size: 0.9rem;
        margin-bottom: 1rem;
      }

      .stat-change {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.85rem;
        font-weight: 500;
      }

      .stat-change.positive {
        color: #10b981;
      }

      .stat-change.negative {
        color: #ef4444;
      }

      .charts-grid {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 2rem;
        margin-bottom: 3rem;
      }

      .chart-container {
        background: white;
        border-radius: 16px;
        padding: 2rem;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        border: 1px solid #e5e7eb;
      }

      .chart-title {
        font-size: 1.3rem;
        font-weight: 600;
        margin-bottom: 1.5rem;
        color: #1f2937;
      }

      .secondary-charts {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 2rem;
        margin-bottom: 3rem;
      }

      .contact-list {
        background: white;
        border-radius: 16px;
        padding: 2rem;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        border: 1px solid #e5e7eb;
      }

      .contact-item {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 1rem 0;
        border-bottom: 1px solid #f3f4f6;
      }

      .contact-item:last-child {
        border-bottom: none;
      }

      .contact-avatar {
        width: 40px;
        height: 40px;
        background: linear-gradient(135deg, #3b82f6, #1e40af);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 600;
      }

      .contact-info {
        flex: 1;
      }

      .contact-name {
        font-weight: 600;
        margin-bottom: 0.2rem;
      }

      .contact-email {
        color: #6b7280;
        font-size: 0.9rem;
      }

      .contact-time {
        color: #9ca3af;
        font-size: 0.8rem;
      }

      .filter-controls {
        display: flex;
        gap: 1rem;
        margin-bottom: 2rem;
        flex-wrap: wrap;
      }

      .filter-btn {
        padding: 0.5rem 1rem;
        border: 1px solid #e5e7eb;
        background: white;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 0.9rem;
      }

      .filter-btn:hover,
      .filter-btn.active {
        background: #3b82f6;
        color: white;
        border-color: #3b82f6;
      }

      .skills-popularity {
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }

      .skill-bar {
        display: flex;
        align-items: center;
        gap: 1rem;
      }

      .skill-name {
        min-width: 80px;
        font-size: 0.9rem;
        font-weight: 500;
      }

      .skill-progress {
        flex: 1;
        height: 8px;
        background: #f3f4f6;
        border-radius: 4px;
        overflow: hidden;
      }

      .skill-fill {
        height: 100%;
        background: linear-gradient(90deg, #3b82f6, #1e40af);
        border-radius: 4px;
        transition: width 0.8s ease;
      }

      .skill-percentage {
        font-size: 0.8rem;
        color: #6b7280;
        min-width: 40px;
      }

      .activity-feed {
        background: white;
        border-radius: 16px;
        padding: 2rem;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        border: 1px solid #e5e7eb;
      }

      .activity-item {
        display: flex;
        align-items: flex-start;
        gap: 1rem;
        padding: 1rem 0;
        border-bottom: 1px solid #f3f4f6;
      }

      .activity-item:last-child {
        border-bottom: none;
      }

      .activity-icon {
        width: 32px;
        height: 32px;
        background: linear-gradient(135deg, #3b82f6, #1e40af);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 0.8rem;
        flex-shrink: 0;
      }

      .activity-content {
        flex: 1;
      }

      .activity-text {
        font-size: 0.9rem;
        margin-bottom: 0.2rem;
      }

      .activity-time {
        color: #9ca3af;
        font-size: 0.8rem;
      }

      .real-time-indicator {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin-bottom: 1rem;
      }

      .live-dot {
        width: 8px;
        height: 8px;
        background: #10b981;
        border-radius: 50%;
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
        100% {
          opacity: 1;
        }
      }

      .export-btn {
        position: fixed;
        bottom: 2rem;
        right: 2rem;
        background: linear-gradient(135deg, #3b82f6, #1e40af);
        color: white;
        border: none;
        border-radius: 50px;
        padding: 1rem 1.5rem;
        font-size: 0.9rem;
        cursor: pointer;
        box-shadow: 0 4px 20px rgba(59, 130, 246, 0.3);
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .export-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 25px rgba(59, 130, 246, 0.4);
      }

      .contact-item {
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .contact-item:hover {
        background: #f8fafc;
        border-radius: 8px;
        padding: 1rem;
        margin: 0 -1rem;
      }

      .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(5px);
      }

      .modal-content {
        background-color: white;
        margin: 5% auto;
        padding: 2rem;
        border-radius: 16px;
        width: 90%;
        max-width: 600px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        position: relative;
      }

      .close {
        position: absolute;
        right: 1.5rem;
        top: 1.5rem;
        font-size: 1.5rem;
        cursor: pointer;
        color: #6b7280;
        transition: color 0.3s ease;
      }

      .close:hover {
        color: #ef4444;
      }

      .contact-detail {
        margin-bottom: 1.5rem;
      }

      .contact-detail label {
        font-weight: 600;
        color: #374151;
        display: block;
        margin-bottom: 0.5rem;
      }

      .contact-detail p {
        color: #6b7280;
        background: #f9fafb;
        padding: 1rem;
        border-radius: 8px;
        border-left: 4px solid #3b82f6;
      }

      .contact-actions {
        display: flex;
        gap: 1rem;
        margin-top: 2rem;
      }

      .action-btn {
        padding: 0.75rem 1.5rem;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 500;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
      }

      .action-btn.primary {
        background: #3b82f6;
        color: white;
      }

      .action-btn.primary:hover {
        background: #1e40af;
      }

      .action-btn.secondary {
        background: #f3f4f6;
        color: #374151;
      }

      .action-btn.secondary:hover {
        background: #e5e7eb;
      }

      @media (max-width: 768px) {
        .dashboard-container {
          padding: 1rem;
        }

        .charts-grid {
          grid-template-columns: 1fr;
        }

        .secondary-charts {
          grid-template-columns: 1fr;
        }

        .dashboard-header h1 {
          font-size: 2rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="dashboard-container">
      <div class="dashboard-header">
        <h1><i class="fas fa-chart-line"></i> Portfolio Analytics Dashboard</h1>
        <p>
          Real-time insights into your portfolio performance and visitor
          engagement
        </p>
      </div>

      <div class="real-time-indicator">
        <div class="live-dot"></div>
        <span
          >Live Data - Last updated:
          <span id="lastUpdated">Just now</span></span
        >
      </div>

      <div class="filter-controls">
        <button class="filter-btn active" data-period="7d">Last 7 Days</button>
        <button class="filter-btn" data-period="30d">Last 30 Days</button>
        <button class="filter-btn" data-period="90d">Last 90 Days</button>
        <button class="filter-btn" data-period="all">All Time</button>
      </div>

      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-header">
            <div class="stat-icon">
              <i class="fas fa-eye"></i>
            </div>
          </div>
          <div class="stat-value" id="totalViews">12,543</div>
          <div class="stat-label">Total Portfolio Views</div>
          <div class="stat-change positive">
            <i class="fas fa-arrow-up"></i>
            <span>+15.3% from last week</span>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-header">
            <div class="stat-icon">
              <i class="fas fa-users"></i>
            </div>
          </div>
          <div class="stat-value" id="uniqueVisitors">3,247</div>
          <div class="stat-label">Unique Visitors</div>
          <div class="stat-change positive">
            <i class="fas fa-arrow-up"></i>
            <span>+8.7% from last week</span>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-header">
            <div class="stat-icon">
              <i class="fas fa-envelope"></i>
            </div>
          </div>
          <div class="stat-value" id="contactSubmissions">89</div>
          <div class="stat-label">Contact Form Submissions</div>
          <div class="stat-change positive">
            <i class="fas fa-arrow-up"></i>
            <span>+23.1% from last week</span>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-header">
            <div class="stat-icon">
              <i class="fas fa-download"></i>
            </div>
          </div>
          <div class="stat-value" id="resumeDownloads">156</div>
          <div class="stat-label">Resume Downloads</div>
          <div class="stat-change negative">
            <i class="fas fa-arrow-down"></i>
            <span>-2.3% from last week</span>
          </div>
        </div>
      </div>

      <div class="charts-grid">
        <div class="chart-container">
          <h3 class="chart-title">Visitor Traffic Over Time</h3>
          <canvas id="trafficChart"></canvas>
        </div>

        <div class="chart-container">
          <h3 class="chart-title">Top Skill Interests</h3>
          <div class="skills-popularity">
            <div class="skill-bar">
              <div class="skill-name">React</div>
              <div class="skill-progress">
                <div class="skill-fill" style="width: 85%"></div>
              </div>
              <div class="skill-percentage">85%</div>
            </div>
            <div class="skill-bar">
              <div class="skill-name">JavaScript</div>
              <div class="skill-progress">
                <div class="skill-fill" style="width: 78%"></div>
              </div>
              <div class="skill-percentage">78%</div>
            </div>
            <div class="skill-bar">
              <div class="skill-name">Node.js</div>
              <div class="skill-progress">
                <div class="skill-fill" style="width: 72%"></div>
              </div>
              <div class="skill-percentage">72%</div>
            </div>
            <div class="skill-bar">
              <div class="skill-name">Figma</div>
              <div class="skill-progress">
                <div class="skill-fill" style="width: 65%"></div>
              </div>
              <div class="skill-percentage">65%</div>
            </div>
            <div class="skill-bar">
              <div class="skill-name">MongoDB</div>
              <div class="skill-progress">
                <div class="skill-fill" style="width: 58%"></div>
              </div>
              <div class="skill-percentage">58%</div>
            </div>
          </div>
        </div>
      </div>

      <div class="secondary-charts">
        <div class="chart-container">
          <h3 class="chart-title">Device Usage</h3>
          <canvas id="deviceChart"></canvas>
        </div>

        <div class="chart-container">
          <h3 class="chart-title">Project Views</h3>
          <canvas id="projectChart"></canvas>
        </div>
      </div>

      <div class="charts-grid">
        <div class="contact-list">
          <h3 class="chart-title">Recent Contact Submissions</h3>
          <div class="contact-item">
            <div class="contact-avatar">AR</div>
            <div class="contact-info">
              <div class="contact-name">Alex Rodriguez</div>
              <div class="contact-email">alex@techcorp.com</div>
              <div class="contact-time">2 hours ago</div>
            </div>
          </div>
          <div class="contact-item">
            <div class="contact-avatar">SM</div>
            <div class="contact-info">
              <div class="contact-name">Sarah Mitchell</div>
              <div class="contact-email">sarah@startup.io</div>
              <div class="contact-time">5 hours ago</div>
            </div>
          </div>
          <div class="contact-item">
            <div class="contact-avatar">DK</div>
            <div class="contact-info">
              <div class="contact-name">David Kim</div>
              <div class="contact-email">david@agency.com</div>
              <div class="contact-time">1 day ago</div>
            </div>
          </div>
          <div class="contact-item">
            <div class="contact-avatar">LW</div>
            <div class="contact-info">
              <div class="contact-name">Lisa Wang</div>
              <div class="contact-email">lisa@design.co</div>
              <div class="contact-time">2 days ago</div>
            </div>
          </div>
          <div class="contact-item">
            <div class="contact-avatar">MJ</div>
            <div class="contact-info">
              <div class="contact-name">Michael Johnson</div>
              <div class="contact-email">mike@freelance.com</div>
              <div class="contact-time">3 days ago</div>
            </div>
          </div>
        </div>

        <div class="activity-feed">
          <h3 class="chart-title">Recent Activity</h3>
          <div class="activity-item">
            <div class="activity-icon">
              <i class="fas fa-eye"></i>
            </div>
            <div class="activity-content">
              <div class="activity-text">
                New visitor viewed E-Commerce project
              </div>
              <div class="activity-time">3 minutes ago</div>
            </div>
          </div>
          <div class="activity-item">
            <div class="activity-icon">
              <i class="fas fa-download"></i>
            </div>
            <div class="activity-content">
              <div class="activity-text">
                Resume downloaded by potential employer
              </div>
              <div class="activity-time">15 minutes ago</div>
            </div>
          </div>
          <div class="activity-item">
            <div class="activity-icon">
              <i class="fas fa-envelope"></i>
            </div>
            <div class="activity-content">
              <div class="activity-text">
                New contact form submission received
              </div>
              <div class="activity-time">1 hour ago</div>
            </div>
          </div>
          <div class="activity-item">
            <div class="activity-icon">
              <i class="fas fa-mouse-pointer"></i>
            </div>
            <div class="activity-content">
              <div class="activity-text">High engagement on About section</div>
              <div class="activity-time">2 hours ago</div>
            </div>
          </div>
          <div class="activity-item">
            <div class="activity-icon">
              <i class="fas fa-share"></i>
            </div>
            <div class="activity-content">
              <div class="activity-text">Portfolio shared on LinkedIn</div>
              <div class="activity-time">4 hours ago</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <button class="export-btn">
      <i class="fas fa-download"></i>
      Export Report
    </button>

    <!-- Contact Detail Modal -->
    <div id="contactModal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2 id="modalTitle">Contact Details</h2>
        <div id="modalContent">
          <!-- Contact details will be populated here -->
        </div>
      </div>
    </div>

    <script type="module">
      // Import Firebase modules
      import { 
        initializeApp 
      } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
      import {
        getFirestore,
        collection,
        getDocs,
        query,
        orderBy,
        limit,
        where,
        onSnapshot,
        serverTimestamp
      } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";
      import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-analytics.js";

      // Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyAEQg3unb-QX2DOm8AJhYD_8-anwhn3qUU",
        authDomain: "portfolio-857ab.firebaseapp.com",
        databaseURL: "https://portfolio-857ab-default-rtdb.firebaseio.com",
        projectId: "portfolio-857ab",
        storageBucket: "portfolio-857ab.firebasestorage.app",
        messagingSenderId: "15819357661",
        appId: "1:15819357661:web:c8fcc46dac656e88690a34",
        measurementId: "G-KJ17K2E93H"
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);
      const analytics = getAnalytics(app);

      // Global variables
      let contactsData = [];
      let charts = {};

      // Initialize charts
      const initCharts = () => {
        // Set chart container heights
        const chartContainers = document.querySelectorAll('.chart-container');
        chartContainers.forEach(container => {
          container.style.height = '400px';
        });

        // Traffic Chart
        const trafficCtx = document
          .getElementById("trafficChart")
          .getContext("2d");
        charts.traffic = new Chart(trafficCtx, {
          type: "line",
          data: {
            labels: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul"],
            datasets: [
              {
                label: "Page Views",
                data: [1200, 1900, 1500, 2200, 2800, 3200, 3500],
                borderColor: "#3b82f6",
                backgroundColor: "rgba(59, 130, 246, 0.1)",
                tension: 0.4,
                fill: true,
                borderWidth: 3,
              },
              {
                label: "Unique Visitors",
                data: [800, 1200, 1000, 1500, 1800, 2100, 2300],
                borderColor: "#1e40af",
                backgroundColor: "rgba(30, 64, 175, 0.1)",
                tension: 0.4,
                fill: true,
                borderWidth: 3,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            interaction: {
              intersect: false,
              mode: 'index',
            },
            scales: {
              y: {
                beginAtZero: true,
                grid: {
                  color: "#f3f4f6",
                  drawBorder: false,
                },
                ticks: {
                  color: "#6b7280",
                  font: {
                    size: 12,
                  },
                },
              },
              x: {
                grid: {
                  color: "#f3f4f6",
                  drawBorder: false,
                },
                ticks: {
                  color: "#6b7280",
                  font: {
                    size: 12,
                  },
                },
              },
            },
            plugins: {
              legend: {
                position: "top",
                labels: {
                  usePointStyle: true,
                  padding: 20,
                  color: "#374151",
                  font: {
                    size: 13,
                    weight: '500',
                  },
                },
              },
              tooltip: {
                backgroundColor: "rgba(0, 0, 0, 0.8)",
                titleColor: "#ffffff",
                bodyColor: "#ffffff",
                borderColor: "#3b82f6",
                borderWidth: 1,
                cornerRadius: 8,
                displayColors: true,
              },
            },
          },
        });

        // Device Chart
        const deviceCtx = document
          .getElementById("deviceChart")
          .getContext("2d");
        charts.device = new Chart(deviceCtx, {
          type: "doughnut",
          data: {
            labels: ["Desktop", "Mobile", "Tablet"],
            datasets: [
              {
                data: [45, 42, 13],
                backgroundColor: ["#3b82f6", "#1e40af", "#93c5fd"],
                borderWidth: 0,
                hoverOffset: 4,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            cutout: '60%',
            plugins: {
              legend: {
                position: "bottom",
                labels: {
                  usePointStyle: true,
                  padding: 20,
                  color: "#374151",
                  font: {
                    size: 13,
                    weight: '500',
                  },
                },
              },
              tooltip: {
                backgroundColor: "rgba(0, 0, 0, 0.8)",
                titleColor: "#ffffff",
                bodyColor: "#ffffff",
                borderColor: "#3b82f6",
                borderWidth: 1,
                cornerRadius: 8,
                callbacks: {
                  label: function(context) {
                    return context.label + ': ' + context.parsed + '%';
                  }
                }
              },
            },
          },
        });

        // Project Chart
        const projectCtx = document
          .getElementById("projectChart")
          .getContext("2d");
        charts.project = new Chart(projectCtx, {
          type: "bar",
          data: {
            labels: ["E-Commerce", "Portfolio", "UI/UX Design"],
            datasets: [
              {
                label: "Views",
                data: [450, 320, 180],
                backgroundColor: [
                  "rgba(59, 130, 246, 0.8)",
                  "rgba(30, 64, 175, 0.8)",
                  "rgba(147, 197, 253, 0.8)"
                ],
                borderColor: [
                  "#3b82f6",
                  "#1e40af",
                  "#93c5fd"
                ],
                borderWidth: 2,
                borderRadius: 8,
                borderSkipped: false,
                hoverBackgroundColor: [
                  "rgba(59, 130, 246, 1)",
                  "rgba(30, 64, 175, 1)",
                  "rgba(147, 197, 253, 1)"
                ],
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              y: {
                beginAtZero: true,
                grid: {
                  color: "#f3f4f6",
                  drawBorder: false,
                },
                ticks: {
                  color: "#6b7280",
                  font: {
                    size: 12,
                  },
                  callback: function(value) {
                    return value.toLocaleString();
                  }
                },
              },
              x: {
                grid: {
                  display: false,
                },
                ticks: {
                  color: "#6b7280",
                  font: {
                    size: 12,
                  },
                },
              },
            },
            plugins: {
              legend: {
                display: false,
              },
              tooltip: {
                backgroundColor: "rgba(0, 0, 0, 0.8)",
                titleColor: "#ffffff",
                bodyColor: "#ffffff",
                borderColor: "#3b82f6",
                borderWidth: 1,
                cornerRadius: 8,
                callbacks: {
                  label: function(context) {
                    return 'Views: ' + context.parsed.y.toLocaleString();
                  }
                }
              },
            },
            interaction: {
              intersect: false,
              mode: 'index',
            },
          },
        });
      };

      // Filter functionality
      const filterBtns = document.querySelectorAll(".filter-btn");
      filterBtns.forEach((btn) => {
        btn.addEventListener("click", () => {
          filterBtns.forEach((b) => b.classList.remove("active"));
          btn.classList.add("active");

          // Update data based on selected period
          updateDashboardData(btn.dataset.period);
        });
      });

      // Update dashboard data
      const updateDashboardData = (period) => {
        // Calculate data based on actual contacts and period
        const totalContacts = contactsData.length;
        const now = new Date();
        
        let filteredContacts = contactsData;
        
        if (period === "7d") {
          const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
          filteredContacts = contactsData.filter(contact => 
            new Date(contact.timestamp) >= weekAgo
          );
        } else if (period === "30d") {
          const monthAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
          filteredContacts = contactsData.filter(contact => 
            new Date(contact.timestamp) >= monthAgo
          );
        } else if (period === "90d") {
          const quarterAgo = new Date(now.getTime() - 90 * 24 * 60 * 60 * 1000);
          filteredContacts = contactsData.filter(contact => 
            new Date(contact.timestamp) >= quarterAgo
          );
        }

        const periodContacts = filteredContacts.length;
        
        // Update stats
        document.getElementById("totalViews").textContent = (totalContacts * 150).toLocaleString();
        document.getElementById("uniqueVisitors").textContent = (totalContacts * 40).toLocaleString();
        document.getElementById("contactSubmissions").textContent = totalContacts;
        document.getElementById("resumeDownloads").textContent = Math.floor(totalContacts * 1.5);

        // Update charts with real data
        updateChartsWithRealData(periodContacts, totalContacts);
      };

      // Update charts with real data
      const updateChartsWithRealData = (periodContacts, totalContacts) => {
        // Update traffic chart
        if (charts.traffic) {
          const baseViews = totalContacts * 150;
          const baseVisitors = totalContacts * 40;
          
          charts.traffic.data.datasets[0].data = [
            Math.floor(baseViews * 0.1),
            Math.floor(baseViews * 0.15),
            Math.floor(baseViews * 0.12),
            Math.floor(baseViews * 0.18),
            Math.floor(baseViews * 0.22),
            Math.floor(baseViews * 0.25),
            Math.floor(baseViews * 0.28)
          ];
          
          charts.traffic.data.datasets[1].data = [
            Math.floor(baseVisitors * 0.1),
            Math.floor(baseVisitors * 0.15),
            Math.floor(baseVisitors * 0.12),
            Math.floor(baseVisitors * 0.18),
            Math.floor(baseVisitors * 0.22),
            Math.floor(baseVisitors * 0.25),
            Math.floor(baseVisitors * 0.28)
          ];
          
          charts.traffic.update('none');
        }

        // Update project chart
        if (charts.project) {
          const projectViews = [
            Math.floor(totalContacts * 45), // E-Commerce
            Math.floor(totalContacts * 32), // Portfolio
            Math.floor(totalContacts * 18)  // UI/UX Design
          ];
          
          charts.project.data.datasets[0].data = projectViews;
          charts.project.update('none');
        }
      };

      // Real-time updates
      const updateTimestamp = () => {
        const now = new Date();
        document.getElementById("lastUpdated").textContent =
          now.toLocaleTimeString();
      };

      // Export functionality
      document.querySelector(".export-btn").addEventListener("click", () => {
        // Simulate export
        const btn = document.querySelector(".export-btn");
        const originalText = btn.innerHTML;

        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Exporting...';
        btn.disabled = true;

        setTimeout(() => {
          btn.innerHTML = '<i class="fas fa-check"></i> Exported!';
          setTimeout(() => {
            btn.innerHTML = originalText;
            btn.disabled = false;
          }, 2000);
        }, 1500);
      });

      // Animate skill bars on load
      const animateSkillBars = () => {
        const skillFills = document.querySelectorAll(".skill-fill");
        skillFills.forEach((fill, index) => {
          setTimeout(() => {
            fill.style.width = fill.style.width;
          }, index * 200);
        });
      };

      // Fetch contact form submissions from Firebase
      const fetchContacts = async () => {
        try {
          const contactsRef = collection(db, "contacts");
          const q = query(contactsRef, orderBy("timestamp", "desc"), limit(50));
          
          const unsubscribe = onSnapshot(q, (querySnapshot) => {
            contactsData = [];
            querySnapshot.forEach((doc) => {
              const data = doc.data();
              contactsData.push({
                id: doc.id,
                ...data,
                timestamp: data.timestamp ? data.timestamp.toDate() : new Date()
              });
            });
            
            updateContactList();
            updateStats();
            updateActivityFeed();
          });

          return unsubscribe;
        } catch (error) {
          console.error("Error fetching contacts:", error);
        }
      };

      // Update contact list with real data
      const updateContactList = () => {
        const contactList = document.querySelector('.contact-list');
        const contactItems = contactList.querySelectorAll('.contact-item');
        
        // Remove existing items
        contactItems.forEach(item => item.remove());
        
        // Add title back
        const title = document.createElement('h3');
        title.className = 'chart-title';
        title.textContent = 'Recent Contact Submissions';
        contactList.appendChild(title);
        
        // Add real contact data
        contactsData.slice(0, 10).forEach(contact => {
          const contactItem = document.createElement('div');
          contactItem.className = 'contact-item';
          
          const initials = contact.name.split(' ').map(n => n[0]).join('').toUpperCase();
          const timeAgo = getTimeAgo(contact.timestamp);
          
          contactItem.innerHTML = `
            <div class="contact-avatar">${initials}</div>
            <div class="contact-info">
              <div class="contact-name">${contact.name}</div>
              <div class="contact-email">${contact.email}</div>
              <div class="contact-time">${timeAgo}</div>
            </div>
          `;
          
          // Add click event to show contact details
          contactItem.addEventListener('click', () => showContactDetails(contact));
          
          contactList.appendChild(contactItem);
        });
      };

      // Show contact details in modal
      const showContactDetails = (contact) => {
        const modal = document.getElementById('contactModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalContent = document.getElementById('modalContent');
        
        modalTitle.textContent = `Contact from ${contact.name}`;
        
        const formattedDate = new Date(contact.timestamp).toLocaleString('en-IN', {
          year: 'numeric',
          month: 'long',
          day: 'numeric',
          hour: '2-digit',
          minute: '2-digit',
          timeZone: 'Asia/Kolkata'
        });
        
        modalContent.innerHTML = `
          <div class="contact-detail">
            <label>Name</label>
            <p>${contact.name}</p>
          </div>
          <div class="contact-detail">
            <label>Email</label>
            <p>${contact.email}</p>
          </div>
          <div class="contact-detail">
            <label>Subject</label>
            <p>${contact.subject}</p>
          </div>
          <div class="contact-detail">
            <label>Message</label>
            <p>${contact.message}</p>
          </div>
          <div class="contact-detail">
            <label>Submitted</label>
            <p>${formattedDate}</p>
          </div>
          <div class="contact-actions">
            <a href="mailto:${contact.email}?subject=Re: ${contact.subject}" class="action-btn primary">
              <i class="fas fa-reply"></i>
              Reply
            </a>
            <button class="action-btn secondary" onclick="copyToClipboard('${contact.email}')">
              <i class="fas fa-copy"></i>
              Copy Email
            </button>
          </div>
        `;
        
        modal.style.display = 'block';
      };

      // Copy to clipboard function
      window.copyToClipboard = (text) => {
        navigator.clipboard.writeText(text).then(() => {
          const btn = event.target.closest('.action-btn');
          const originalText = btn.innerHTML;
          btn.innerHTML = '<i class="fas fa-check"></i> Copied!';
          setTimeout(() => {
            btn.innerHTML = originalText;
          }, 2000);
        });
      };

      // Track page views using localStorage
      const trackPageView = () => {
        const today = new Date().toDateString();
        const views = JSON.parse(localStorage.getItem('portfolioViews') || '{}');
        
        if (!views[today]) {
          views[today] = 0;
        }
        views[today]++;
        
        localStorage.setItem('portfolioViews', JSON.stringify(views));
        
        // Track unique visitors
        const visitorId = localStorage.getItem('visitorId');
        if (!visitorId) {
          const newVisitorId = 'visitor_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
          localStorage.setItem('visitorId', newVisitorId);
          
          const uniqueVisitors = JSON.parse(localStorage.getItem('uniqueVisitors') || '[]');
          if (!uniqueVisitors.includes(newVisitorId)) {
            uniqueVisitors.push(newVisitorId);
            localStorage.setItem('uniqueVisitors', JSON.stringify(uniqueVisitors));
          }
        }
      };

      // Update stats with real data
      const updateStats = () => {
        const totalContacts = contactsData.length;
        const today = new Date();
        
        // Get real view data from localStorage
        const views = JSON.parse(localStorage.getItem('portfolioViews') || '{}');
        const totalViews = Object.values(views).reduce((sum, count) => sum + count, 0);
        const todayViews = views[today] || 0;
        
        // Get unique visitors
        const uniqueVisitors = JSON.parse(localStorage.getItem('uniqueVisitors') || '[]');
        const totalUniqueVisitors = uniqueVisitors.length;
        
        // Calculate today's unique visitors (simplified)
        const todayUniqueVisitors = Math.floor(todayViews * 0.7); // Estimate 70% of views are unique
        
        // Update stats with real data
        document.getElementById("totalViews").textContent = totalViews.toLocaleString();
        document.getElementById("uniqueVisitors").textContent = totalUniqueVisitors.toLocaleString();
        document.getElementById("contactSubmissions").textContent = totalContacts;
        document.getElementById("resumeDownloads").textContent = Math.floor(totalContacts * 1.5);
        
        // Update change indicators
        updateChangeIndicators(todayViews, todayUniqueVisitors, totalContacts);
      };

      // Update change indicators based on real data
      const updateChangeIndicators = (todayViews, todayUniqueVisitors, totalContacts) => {
        const yesterday = new Date(Date.now() - 24 * 60 * 60 * 1000).toDateString();
        const views = JSON.parse(localStorage.getItem('portfolioViews') || '{}');
        const yesterdayViews = views[yesterday] || 0;
        
        // Calculate percentage changes
        const viewsChange = yesterdayViews > 0 ? ((todayViews - yesterdayViews) / yesterdayViews * 100).toFixed(1) : 0;
        const visitorsChange = yesterdayViews > 0 ? ((todayUniqueVisitors - Math.floor(yesterdayViews * 0.7)) / (yesterdayViews * 0.7) * 100).toFixed(1) : 0;
        
        // Update change indicators
        updateChangeIndicator('totalViews', viewsChange);
        updateChangeIndicator('uniqueVisitors', visitorsChange);
        updateChangeIndicator('contactSubmissions', totalContacts > 0 ? '+100' : '0');
        updateChangeIndicator('resumeDownloads', totalContacts > 0 ? '+50' : '0');
      };

      // Update individual change indicator
      const updateChangeIndicator = (elementId, change) => {
        const element = document.getElementById(elementId).parentElement.querySelector('.stat-change');
        if (element) {
          const isPositive = parseFloat(change) >= 0;
          element.className = `stat-change ${isPositive ? 'positive' : 'negative'}`;
          element.innerHTML = `
            <i class="fas fa-arrow-${isPositive ? 'up' : 'down'}"></i>
            <span>${isPositive ? '+' : ''}${change}% from yesterday</span>
          `;
        }
      };

      // Update activity feed with real data
      const updateActivityFeed = () => {
        const activityFeed = document.querySelector('.activity-feed');
        const activityItems = activityFeed.querySelectorAll('.activity-item');
        
        // Remove existing items
        activityItems.forEach(item => item.remove());
        
        // Add title back
        const title = document.createElement('h3');
        title.className = 'chart-title';
        title.textContent = 'Recent Activity';
        activityFeed.appendChild(title);
        
        // Add real activity data
        contactsData.slice(0, 5).forEach(contact => {
          const activityItem = document.createElement('div');
          activityItem.className = 'activity-item';
          
          const timeAgo = getTimeAgo(contact.timestamp);
          
          activityItem.innerHTML = `
            <div class="activity-icon">
              <i class="fas fa-envelope"></i>
            </div>
            <div class="activity-content">
              <div class="activity-text">New contact form submission from ${contact.name}</div>
              <div class="activity-time">${timeAgo}</div>
            </div>
          `;
          
          activityFeed.appendChild(activityItem);
        });
      };

      // Helper function to get time ago
      const getTimeAgo = (date) => {
        const now = new Date();
        const diffInSeconds = Math.floor((now - date) / 1000);
        
        if (diffInSeconds < 60) return 'Just now';
        if (diffInSeconds < 3600) return `${Math.floor(diffInSeconds / 60)} minutes ago`;
        if (diffInSeconds < 86400) return `${Math.floor(diffInSeconds / 3600)} hours ago`;
        if (diffInSeconds < 2592000) return `${Math.floor(diffInSeconds / 86400)} days ago`;
        return `${Math.floor(diffInSeconds / 2592000)} months ago`;
      };

      // Export functionality with real data
      const exportData = () => {
        const csvContent = "data:text/csv;charset=utf-8," 
          + "Name,Email,Subject,Message,Timestamp\n"
          + contactsData.map(contact => 
              `"${contact.name}","${contact.email}","${contact.subject}","${contact.message}","${contact.timestamp}"`
            ).join("\n");
        
        const encodedUri = encodeURI(csvContent);
        const link = document.createElement("a");
        link.setAttribute("href", encodedUri);
        link.setAttribute("download", "portfolio_contacts.csv");
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      };

      // Handle chart resizing
      const handleChartResize = () => {
        Object.values(charts).forEach(chart => {
          if (chart) {
            chart.resize();
          }
        });
      };

      // Initialize dashboard
      document.addEventListener("DOMContentLoaded", async () => {
        // Track this page view
        trackPageView();
        
        initCharts();
        updateTimestamp();
        animateSkillBars();
        
        // Fetch real data from Firebase
        await fetchContacts();

        // Update timestamp every 30 seconds
        setInterval(updateTimestamp, 30000);

        // Modal functionality
        const modal = document.getElementById('contactModal');
        const closeBtn = document.querySelector('.close');

        closeBtn.onclick = () => {
          modal.style.display = 'none';
        };

        window.onclick = (event) => {
          if (event.target === modal) {
            modal.style.display = 'none';
          }
        };

        // Handle window resize
        window.addEventListener('resize', () => {
          setTimeout(handleChartResize, 100);
        });

        // Initial chart resize after data loads
        setTimeout(handleChartResize, 500);
      });

      // Update export button functionality
      document.querySelector(".export-btn").addEventListener("click", () => {
        const btn = document.querySelector(".export-btn");
        const originalText = btn.innerHTML;

        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Exporting...';
        btn.disabled = true;

        setTimeout(() => {
          exportData();
          btn.innerHTML = '<i class="fas fa-check"></i> Exported!';
          setTimeout(() => {
            btn.innerHTML = originalText;
            btn.disabled = false;
          }, 2000);
        }, 500);
      });
    </script>
  </body>
</html>
